# PostgreSQL 15 Configuration File
# Save this as: postgresql.conf

# -----------------------------
# CONNECTION AND AUTHENTICATION
# -----------------------------

# Connection settings
listen_addresses = '*'                  # Listen on all interfaces
port = 5432                            # PostgreSQL port
max_connections = 200                  # Maximum concurrent connections

# Authentication
#authentication_timeout = 1min         # Maximum time to complete authentication
#ssl = off                             # Enable SSL connections

# -----------------------------
# RESOURCE USAGE (MEMORY)
# -----------------------------

# Memory settings for better performance
shared_buffers = 256MB                 # PostgreSQL shared memory buffer
effective_cache_size = 1GB            # Effective cache size hint for planner
work_mem = 4MB                         # Memory used for internal sort operations
maintenance_work_mem = 64MB            # Memory for maintenance operations

# Temporary files
#temp_buffers = 8MB                    # Memory for temporary tables

# -----------------------------
# WRITE AHEAD LOG
# -----------------------------

# WAL settings
wal_level = replica                    # Level of information written to WAL
max_wal_size = 2GB                     # Maximum size WAL can grow
min_wal_size = 80MB                    # Minimum size to shrink WAL

# Checkpoints
#checkpoint_completion_target = 0.9    # Target completion time for checkpoint

# -----------------------------
# QUERY TUNING
# -----------------------------

# Query planner settings
random_page_cost = 1.1                 # Cost estimate for random page access
effective_io_concurrency = 200         # Number of concurrent I/O operations

# Other planner settings
#cpu_tuple_cost = 0.01                 # CPU cost per tuple processed
#cpu_index_tuple_cost = 0.005          # CPU cost per index tuple

# -----------------------------
# REPORTING AND LOGGING
# -----------------------------

# Where to log - use stderr to avoid permission issues
log_destination = 'stderr'             # Log output destination
logging_collector = off                # Disable file logging to avoid permission issues

# What to log
log_statement = 'all'                  # Log all SQL statements
log_duration = on                      # Log duration of statements
log_min_duration_statement = 0        # Log all statements (set to -1 to disable)

# Log line format
log_line_prefix = '%t [%p]: [%l-1] user=%u,db=%d,app=%a,client=%h '

# Error reporting
log_error_verbosity = default          # Controls verbosity of error logs

# -----------------------------
# STATISTICS AND MONITORING
# -----------------------------

# Query statistics
shared_preload_libraries = 'pg_stat_statements'  # Load statistics module
track_activities = on                   # Track currently executing commands
track_counts = on                      # Track table/index access statistics
track_functions = all                  # Track function call statistics
track_activity_query_size = 2048       # Size of query text buffer

# pg_stat_statements settings (if loaded)
pg_stat_statements.track = all         # Track all statements
pg_stat_statements.max = 10000         # Maximum number of statements tracked
pg_stat_statements.save = on           # Save statistics across restarts

# -----------------------------
# CLIENT CONNECTION DEFAULTS
# -----------------------------

# Timezone and locale
timezone = 'UTC'                       # Server timezone
lc_messages = 'en_US.UTF-8'           # Message language
lc_monetary = 'en_US.UTF-8'           # Monetary formatting
lc_numeric = 'en_US.UTF-8'            # Number formatting
lc_time = 'en_US.UTF-8'               # Time formatting

# Default text search configuration
default_text_search_config = 'pg_catalog.english'

# -----------------------------
# PERFORMANCE OPTIMIZATIONS
# -----------------------------

# Asynchronous I/O (Linux only)
#effective_io_concurrency = 200       # Already set above

# Parallel processing
max_parallel_workers = 8               # Maximum parallel workers
max_parallel_workers_per_gather = 2   # Maximum workers per Gather node
max_parallel_maintenance_workers = 2  # Maximum workers for maintenance

# Background writer
#bgwriter_delay = 200ms                # Background writer delay
#bgwriter_lru_maxpages = 100          # Maximum pages to write per round

# -----------------------------
# REPLICATION (if needed)
# -----------------------------

# Primary server settings
#max_wal_senders = 3                  # Maximum WAL sender processes
#wal_sender_timeout = 60s             # WAL sender timeout

# Standby server settings
#hot_standby = on                     # Enable hot standby mode
#max_standby_streaming_delay = 30s    # Maximum streaming delay

# -----------------------------
# CUSTOM SETTINGS
# -----------------------------

# Add any custom application-specific settings here

# For development environments, you might want to enable:
#log_all_sql = on                     # Custom setting (not standard PostgreSQL)

# Note: Uncomment and modify settings as needed for your specific use case
# Many settings require a server restart to take effect